FROM <%= @package[:from] %>
MAINTAINER <%= @basic[:maintainer] %>
LABEL Description="<%= @package[:description] %>" Vendor="<%= @basic[:origin] %>" Version="<%= @basic[:version] %>"

# controller run on port 10252
EXPOSE 10252

# environment variables used for controller
ENV API_SERVER="http://localhost:9636"
ENV DNS_ENDPOINT="http://localhost:8081"
ENV DNS_PROVIDER="powerdns"
ENV DNS_APIKEY="a_strong_api_key"

# default environment variables
ENV SOURCE_DIR <%= @basic[:home]+"/controller/bin" %>
ENV CONF_FILE rioos.conf
ENV RIOCONF <%= @basic[:libhome] %>/controller

# volume creation
RUN mkdir -p "$SOURCE_DIR"
RUN mkdir -p "$RIOCONF"
VOLUME "$RIOCONF"

WORKDIR "$SOURCE_DIR"
COPY <%= @package[:package]+"/src/"+@package[:git_org]+"/beedi/_outputs" %> $SOURCE_DIR

COPY entrypoint.sh $SOURCE_DIR
RUN chmod 755 $SOURCE_DIR/entrypoint.sh
ENTRYPOINT ["<%= @basic[:home]+"/controller/bin/entrypoint.sh" %>"]

CMD ["controller"]
