#!/bin/bash

cd <%= @package[:package]+"/src/"+@package[:git_org]+"/aran" %>

# sometimes  the dependencies aren't getting pulled. Adding a master solved the problem.
git remote add master https://gitlab.com/rajesh_rajagopal/aran.git
sh support/linux/install_dev_0_ubuntu_latest.sh
sh support/linux/install_dev_9_linux.sh
. ~/.profile

make FLAGS=--release buildapi

cp tools/config/api.toml ../../../../../
cp -r tools/config/template ../../../../../

cd ../../../../..

cp ../../../entrypoint.sh .

sudo docker build -t rio-apiserver -f Dockerfile .

sudo docker tag rio-apiserver <%= @basic[:registry_url]+"/rioosapiserver:"+@basic[:version] %>

sudo docker push <%= @basic[:registry_url]+"/rioosapiserver:"+@basic[:version] %>
